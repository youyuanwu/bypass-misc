---
# Test private network connectivity between VMs
- name: Private Network Connectivity Test
  hosts: vms
  gather_facts: false

  tasks:
    - name: Ping all other VMs via private IP
      ansible.builtin.shell: |
        ping -c 3 {{ hostvars[item].private_ip }}
      loop: "{{ groups['vms'] }}"
      when: item != inventory_hostname
      register: ping_results

    - name: Display ping results
      ansible.builtin.debug:
        msg: "{{ item.stdout_lines }}"
      loop: "{{ ping_results.results }}"
      when: item.stdout_lines is defined
